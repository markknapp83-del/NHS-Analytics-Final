{
  "test_timestamp": "2025-09-25T16:44:45.757636",
  "test_phase": "Phase 2: Cancer Data Processing Accuracy",
  "data_directory": "/Users/markknapp/Desktop/Projects/NHS-Data-Analytics-Tool-v6-master/Data",
  "files_processed": [
    {
      "filename": "CWT-CRS-Apr-2024-to-Sep-2024-Data-Extract-Provider-Final.xlsx",
      "trusts_processed": 147,
      "processing_time": 5.734132,
      "success": true
    },
    {
      "filename": "CWT-CRS-Oct-2024-to-Mar-2025-Data-Extract-Provider.xlsx",
      "trusts_processed": 144,
      "processing_time": 5.708013,
      "success": true
    },
    {
      "filename": "CWT-CRS-Apr-2025-to-Jul-2025-Data-Extract-Provider.xlsx",
      "trusts_processed": 146,
      "processing_time": 4.888449,
      "success": true
    }
  ],
  "validation_results": {
    "processing_pipeline": {
      "files_processed": 3,
      "files_failed": 0,
      "pipeline_errors": [],
      "processing_times": {
        "CWT-CRS-Apr-2024-to-Sep-2024-Data-Extract-Provider-Final.xlsx": 5.734132,
        "CWT-CRS-Oct-2024-to-Mar-2025-Data-Extract-Provider.xlsx": 5.708013,
        "CWT-CRS-Apr-2025-to-Jul-2025-Data-Extract-Provider.xlsx": 4.888449
      },
      "output_generated": true
    },
    "data_transformation": {
      "files_tested": 1,
      "transformation_accuracy": {
        "overall": 100.0
      },
      "field_mapping_errors": [],
      "data_loss_detected": false,
      "sample_validations": [
        {
          "trust_code": "R0A",
          "transformation_accurate": true,
          "errors": [],
          "metrics_checked": 9,
          "metrics_passed": 9
        },
        {
          "trust_code": "R0D",
          "transformation_accurate": true,
          "errors": [],
          "metrics_checked": 9,
          "metrics_passed": 9
        },
        {
          "trust_code": "R1F",
          "transformation_accurate": true,
          "errors": [],
          "metrics_checked": 9,
          "metrics_passed": 9
        }
      ]
    },
    "performance_calculations": {
      "calculations_tested": 45,
      "calculations_accurate": 45,
      "calculation_errors": [],
      "tolerance_threshold": 0.1
    },
    "mapping_accuracy": {
      "cancer_type_mappings": {
        "tested": 32,
        "accurate": 30,
        "errors": [
          "Urological - Other (a)",
          "Urological - Prostate"
        ],
        "accuracy_rate": 93.75
      },
      "route_mappings": {
        "tested": 9,
        "accurate": 9,
        "errors": [],
        "accuracy_rate": 100.0
      },
      "modality_mappings": {
        "tested": 5,
        "accurate": 5,
        "errors": [],
        "accuracy_rate": 100.0
      },
      "unmapped_values": {
        "cancer_types": [
          "Urological - Other (a)",
          "Urological - Prostate"
        ],
        "routes": [],
        "modalities": []
      }
    },
    "jsonb_structure": {
      "structures_tested": 9,
      "valid_structures": 9,
      "structure_errors": [],
      "required_fields_missing": [],
      "data_types_correct": true
    },
    "data_preservation": {
      "files_tested": 2,
      "data_preservation_rate": 89.81481481481481,
      "potential_data_loss": [
        {
          "file": "CWT-CRS-Apr-2024-to-Sep-2024-Data-Extract-Provider-Final.xlsx",
          "issue": "Only 88.6% of trusts preserved",
          "raw_trusts": 166,
          "processed_trusts": 147
        }
      ],
      "record_count_comparison": {
        "CWT-CRS-Apr-2024-to-Sep-2024-Data-Extract-Provider-Final.xlsx": {
          "raw_records": 61780,
          "raw_trusts": 166,
          "processed_trusts": 147,
          "processed_total_treated": 2624531
        },
        "CWT-CRS-Oct-2024-to-Mar-2025-Data-Extract-Provider.xlsx": {
          "raw_records": 61649,
          "raw_trusts": 158,
          "processed_trusts": 144,
          "processed_total_treated": 2567764
        }
      }
    },
    "quarter_aggregation": {
      "quarter_mappings_tested": 4,
      "accurate_quarters": 4,
      "quarter_errors": [],
      "month_groupings": {
        "['APR', 'MAY', 'JUN']": {
          "expected": "2024-Q1",
          "actual": "2024-Q1",
          "period_start": "2024-04-01"
        },
        "['JUL', 'AUG', 'SEP']": {
          "expected": "2024-Q2",
          "actual": "2024-Q2",
          "period_start": "2024-07-01"
        },
        "['OCT', 'NOV', 'DEC']": {
          "expected": "2024-Q3",
          "actual": "2024-Q3",
          "period_start": "2024-10-01"
        },
        "['JAN', 'FEB', 'MAR']": {
          "expected": "2025-Q4",
          "actual": "2025-Q4",
          "period_start": "2025-01-01"
        },
        "CWT-CRS-Apr-2024-to-Sep-2024-Data-Extract-Provider-Final.xlsx": {
          "months": [
            "APR",
            "MAY",
            "JUN",
            "JUL",
            "AUG",
            "SEP"
          ],
          "quarter": "2024-Q1",
          "period_start": "2024-04-01"
        }
      }
    }
  },
  "summary": {
    "files_tested": 3,
    "successful_processing": 3,
    "overall_accuracy_score": 100.0,
    "critical_issues": 0,
    "high_issues": 0,
    "medium_issues": 1,
    "accuracy_metrics": {
      "transformation": 100.0,
      "calculations": 100.0,
      "structure": 100.0
    }
  },
  "issues_found": [
    {
      "severity": "MEDIUM",
      "category": "DATA_LOSS",
      "description": "Data preservation rate below threshold: 89.8%",
      "impact": "Some source data may not be processed",
      "recommendation": "Review filtering logic and ensure all valid trusts are processed"
    }
  ],
  "recommendations": [
    "\u2705 Proceed to Phase 3 database validation if accuracy is satisfactory"
  ],
  "overall_status": "MEDIUM_ISSUES"
}